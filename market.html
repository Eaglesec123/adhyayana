<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Marketplace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:#0f172a;
  color:white;
}

/* HEADER */

.header{
  background:#111827;
  padding:20px 30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:15px;
  box-shadow:0 5px 20px rgba(0,0,0,0.4);
}

.header-left{
  display:flex;
  align-items:center;
  gap:15px;
}

.header-left a{
  text-decoration:none;
  color:#22c55e;
  font-weight:600;
}

.header-left a:hover{
  text-decoration:underline;
}

.header-controls{
  display:flex;
  gap:10px;
  align-items:center;
}

input, select{
  padding:8px 12px;
  border-radius:8px;
  border:none;
  background:#1e293b;
  color:white;
}

.cart-icon{
  cursor:pointer;
  position:relative;
  font-weight:600;
}

.cart-count{
  position:absolute;
  top:-8px;
  right:-10px;
  background:#ef4444;
  color:white;
  font-size:12px;
  padding:2px 6px;
  border-radius:50%;
}

/* GRID */

.grid{
  max-width:1200px;
  margin:40px auto;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:30px;
  padding:0 20px;
}

/* CARD */

.card{
  background:#1e293b;
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
  transition:0.4s ease;
  transform:scale(0.95);
  opacity:0;
  animation:fadeUp 0.6s forwards;
}

@keyframes fadeUp{
  to{
    transform:scale(1);
    opacity:1;
  }
}

.card:hover{
  transform:translateY(-8px) scale(1.02);
  box-shadow:0 25px 50px rgba(0,0,0,0.6);
}

.card img{
  width:100%;
  height:180px;
  object-fit:cover;
  transition:0.4s;
}

.card:hover img{
  transform:scale(1.05);
}

.card-body{
  padding:18px;
}

.card-body h4{
  margin-bottom:8px;
}

.price{
  font-weight:700;
  margin:8px 0 12px;
  font-size:16px;
  color:#22c55e;
}

/* BUTTONS */

.buttons{
  display:flex;
  gap:10px;
  margin-top:10px;
}

button{
  padding:10px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  transition:0.3s;
}

.add-btn{
  flex:1;
  background:#2563eb;
  color:white;
}

.add-btn:hover{
  background:#1d4ed8;
}

.buy-btn{
  flex:1;
  background:#7c3aed;
  color:white;
}

.buy-btn:hover{
  background:#6d28d9;
}

button[style*="red"]{
  background:#dc2626 !important;
}

button[style*="red"]:hover{
  background:#b91c1c !important;
}
</style>
</head>

<body>

<div class="header">
  <div class="header-left">
    <a href="dashboard.html">‚Üê Dashboard</a>
    <h3>Marketplace</h3>
  </div>

  <div class="header-controls">
    <input type="text" id="searchInput" placeholder="Search courses...">
    <select id="categoryFilter">
      <option value="">All</option>
      <option value="Web">Web</option>
      <option value="App">App</option>
      <option value="Design">Design</option>
    </select>
    <div class="cart-icon" onclick="window.location='cart.html'">
      üõí Cart
      <span id="cartCount" class="cart-count">0</span>
    </div>
  </div>
</div>

<div id="content"></div>

<script type="module">

/* üî• YOUR ORIGINAL JS ‚Äî NOT CHANGED */

import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import { 
  getFirestore, 
  collection, 
  getDocs,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

import {
  getAuth,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyC0HLb1TVf3vJCQEQr2pUOonoXoKnjbrtw",
  authDomain: "login-65d4b.firebaseapp.com",
  projectId: "login-65d4b",
  storageBucket: "login-65d4b.appspot.com",
  messagingSenderId: "239979806578",
  appId: "1:239979806578:web:65db25b7e975ef0f1867eb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const ADMIN_EMAIL = "admin@gmail.com";

let currentUser = null;

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let purchased = JSON.parse(localStorage.getItem("purchased")) || [];
let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];

updateCartCount();

function updateCartCount(){
  document.getElementById("cartCount").innerText = cart.length;
}

window.addToCart = function(id,title,price){
  if(!cart.find(item=>item.id===id)){
      cart.push({id,title,price});
      localStorage.setItem("cart",JSON.stringify(cart));
      updateCartCount();
      alert("Added to cart ‚úÖ");
  }
};

window.addToWishlist = function(id){
  if(!wishlist.includes(id)){
    wishlist.push(id);
    localStorage.setItem("wishlist",JSON.stringify(wishlist));
    alert("Added to wishlist ‚ù§Ô∏è");
  }
};

window.deleteCourse = async function(id){
  if(!currentUser || currentUser.email !== ADMIN_EMAIL){
    alert("Only Admin Can Delete ‚ùå");
    return;
  }
  if(confirm("Delete this course?")){
    await deleteDoc(doc(db,"courses",id));
    alert("Course Deleted ‚úÖ");
    loadCourses();
  }
};

onAuthStateChanged(auth,(user)=>{
  currentUser = user;
  loadCourses();
});

async function loadCourses(){

  const snapshot = await getDocs(collection(db,"courses"));
  let html="<div class='grid'>";

  snapshot.forEach(docSnap=>{

    const c=docSnap.data();
    const category = c.category || "";

    html+=`
      <div class="card" data-title="${c.title.toLowerCase()}" data-category="${category}">
        <img src="${c.thumbnailUrl || 'https://via.placeholder.com/300x170'}">
        <div class="card-body">
          <h4>${c.title}</h4>
          <div class="price">‚Çπ ${c.price}</div>
          <div class="buttons">

            <button class="add-btn"
              onclick="addToCart('${docSnap.id}','${c.title}','${c.price}')">
              Add
            </button>

            <button class="buy-btn"
              onclick="
                addToCart('${docSnap.id}','${c.title}','${c.price}');
                window.location='cart.html';
              ">
              Buy
            </button>

            ${
              currentUser && currentUser.email === ADMIN_EMAIL
              ? `<button style="background:red;color:white;"
                   onclick="deleteCourse('${docSnap.id}')">
                   Delete
                 </button>`
              : ""
            }

          </div>
        </div>
      </div>
    `;
  });

  html+="</div>";
  document.getElementById("content").innerHTML=html;
}

</script>

</body>
</html>
